node {

    // ===== GLOBAL VARIABLES (VERY IMPORTANT) =====
    def branchName
    def mvnGoals
    def javaTool

    stage('Init') {

        branchName = params.BRANCH ?: 'master'
        mvnGoals   = params.MVN_GOALS ?: 'clean package'
        javaTool   = params.JDK_VER ?: 'JDK8'

        echo "Selected Branch: ${branchName}"
        echo "Maven Goals: ${mvnGoals}"
        echo "Java Version: ${javaTool}"

        env.JAVA_HOME = tool name: javaTool, type: 'jdk'
        env.PATH = "${env.JAVA_HOME}/bin:${env.PATH}"

        sh 'java -version'
        sh 'mvn -version'
    }

    stage('Checkout') {
        git url: 'https://github.com/betawins/spring3-mvc-maven-xml-hello-world-1.git',
            branch: branchName
    }

    stage('Build') {
        sh "mvn ${mvnGoals}"
    }

    stage('Archive') {
        archiveArtifacts artifacts: 'target/*.war', fingerprint: true
    }

    stage('Cleanup') {
        cleanWs()
    }
}
